# Атрибуты

Атрибуты компиляторов -- некоторые расширения, позволяющие контролировать их поведение.

Используются для:
* поиска ошибок
* улучшения производительности
* нахождения нежелательного поведения
* ...


В каждом компиляторе свои атрибуты и свой синтаксис. Например, в GNU  `__attribute__(name)`.
Но добавление compiler-specific атрибутов снижает совместимость кода.

В С++11 появились стандартные атрибуты, которые унифицируют синтаксис:
`[[name]]`. Компилятор обязан пропускать атрибуты в двойных квадратных скобках, которые не смог распарсить, поэтому совместимость не нарушится.



### Стандартные атрибуты

*  `[[deprecated]]`.
Помечает функцию/метод/переменную/... как поддерживаемую, но нежелательную для использования. Кидает warning при использовании.
*  `[[fallthrough]]`.
   Позволяет проваливаться в switch/case в следующий кейс без warning-a.
*  `[[likely]], [[unlikely]]` (C++20).
   Сообщает компилятору, что какое-то из ветвлений в программе более вероятное (и менее вероятное, соответственно).
*  `[[maybe_unused]]`.
   Просит компилятор не ругаться на неиспользованные сущности. Работает не только для переменных, но и для классов, функций, алиасов etc. 
* `[[no_unique_address]]`.
  Сообщает что члену класса не нужен свой адрес (тут нужно вспомнить empty base optimization).
* `[[nodiscard]]`. Похоже на maybe_unused наоборот. Просит компилятор показывать warning, если возвращаемое значение у помеченной функции не используется.

### compiler-specific атрибуты
* `__attribute__((cleanup(func)))`. 
Указывает на функцию, которую нужно вызвать при разрушении (не статик) объекта.
* `__attribute__((enable_if(exp, str)))` Принимает 2 аргумента: выражение и строку для объяснения почему данная перегрузка не подошла.
[Пример](https://github.com/abseil/abseil-cpp/blob/4bb9e39c88854dbf466688177257d11810719853/absl/strings/internal/str_format/bind.h#L108).
* Thread annotations. Набор атрибутов, позволяющий избегать ошибок в мультипоточном коде. 
  С их помощью можно аннотировать код маркерами, которые будут проверяться на этапе компиляции.
  Например, указать, что изменение конкретной переменной должно происходить под конкретным мьютексом или .
  При этом мьютекс обязан быть помеченным как `__attribute((locable))__`.
  Но пользоваться им нужно аккуратно. Бывают false-positive warning-и, например [thread_annotations_are_slippery.cpp].
