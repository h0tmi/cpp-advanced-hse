# Как мы проверяем задачи на многопоточность

Тестирование задач, в которых вы используете много потоков, устроено немного иначе. В частности, чтобы проверить, что вы действительно написали эффективное решение, которое правильно использует потоки, мы запускаем еще и *бенчмарки* - программы, которые запускают ваш код на определенных входах, но не проверяют инварианты, а только считают затраченное время. Бенчмарки собираются только в релизной сборке (с оптимизациями и без санитайзеров).

Мы смотрим на две статистики - CPU time и Real (wall) time. Первая показывает, сколько процессорного времени вы потратили, она зависит от объема работы, который проделали все потоки. Real time - обычное время работы программы. В случае, если ваша программа хорошо распараллеливает вычисления (например, вычисляет сумму корней на отрезке), и все созданные вами потоки могут параллельно исполняться на вашем компьютере, то примерно выполняется соотношение `Wall time * Threads count = CPU time`, и при изменении числа потоков CPU time практически не будет изменяться.

На сервере мы запускаем каждый бенчмарк 10 раз. При запуске выводится статистика запусков, она передается на вход скрипту scorer.py, если он есть в папке с задачей. Этот скрипт сравнивает медианное время работы каждого бенчмарка с порогами, которые указаны в скрипте - и если они не превышены, засчитывает задачу.

Помимо бенчмарков есть, как и раньше, тесты на корректность. Они запускаются в трех сборках - релизной, ASAN и TSAN - thread sanitizer - с санитайзером, который определяет data race в вашей программе. Каждый тест в каждой сборке запускается 10 раз, любое падение приводит к незасчету задачи.

Время работы бенчмарков на сервере и локально может отличаться - тем не менее, можно примерно оценить, насколько на сервере работает медленнее, и понять, к чему стремиться. Пожалуйста, не отправляйте решение на сервер много раз без содержательных изменений - это не имеет большого смысла и только загрузит тестирующую систему. Если какой-то тест или бенчмарк вам кажется странным, приходите в чат.
